# DriftNet

DriftNet — это децентрализованная P2P-сеть для передачи и хранения файлов по частям (чанкам) между множеством узлов. Система состоит из нескольких .NET приложений:

- **DriftCoordinator** — координатор сети, регистрирует узлы и выдает список пиров
- **DriftNode** — узел сети, хранит чанки, пересылает их другим узлам
- **DriftUploader** — CLI-утилита для загрузки файла в сеть (разбивает на чанки и отправляет на узлы)
- **DriftGetter** — CLI-утилита для восстановления файла из сети (скачивает чанки с узлов и собирает файл)

## Как это работает

1. **Координатор** запускается и слушает порт 8000.
2. **20 узлов** запускаются, регистрируются у координатора и слушают свои TCP-порты (5001-5020).
3. **Uploader** по вашей команде разбивает файл на чанки и отправляет их на 5 случайных узлов.
4. **Getter** по вашей команде скачивает чанки с узлов и собирает файл обратно.

Вся система работает в одной Docker-сети, все взаимодействия идут по внутренним адресам.

---

## Быстрый старт

### 1. Соберите и запустите всю сеть:

```bash
docker-compose up --build -d
```

Это поднимет координатор, 20 узлов, uploader и getter (последние два — в "ожидании").

### 2. Проверьте, что все контейнеры работают:

```bash
docker-compose ps
```

---

## Загрузка файла в сеть

1. Поместите файл для загрузки в корень проекта с именем `testfile.txt` (или измените volume в docker-compose.yml).
2. Запустите загрузку:

```bash
docker-compose run --rm uploader /app/testfile.txt
```

- Файл будет разбит на чанки и отправлен на 5 случайных узлов.
- В логе увидите, как чанки распространяются по сети.

---

## Восстановление файла из сети

1. Запустите восстановление:

```bash
docker-compose run --rm getter chunk- --out /app/output/recovered.txt
```

- Файл будет собран из чанков, найденных на узлах.
- Восстановленный файл появится в папке `output` на вашей машине как `recovered.txt`.

---

## Проверка целостности

Сравните оригинальный и восстановленный файл:

```bash
diff testfile.txt output/recovered.txt
```

Если diff ничего не выводит — файлы идентичны!

---

## Описание сервисов

- **coordinator** — координатор сети (порт 8000)
- **node1 ... node20** — узлы сети (порты 5001-5020)
- **uploader** — CLI для загрузки файла (запускается вручную)
- **getter** — CLI для восстановления файла (запускается вручную)

---

## Полезные команды

- Посмотреть логи координатора:
  ```bash
  docker logs coordinator
  ```
- Посмотреть логи узла:
  ```bash
  docker logs node1
  ```
- Проверить зарегистрированные узлы:
  ```bash
  curl http://localhost:8000/peers
  ```

---

## Примечания

- Все сервисы работают в одной bridge-сети Docker (`driftnet`).
- Если узлы не видны координатору, перезапустите их:
  ```bash
  docker-compose restart node1 node2 node3 ...
  ```
- Для загрузки/выгрузки можно использовать любые файлы, просто меняйте путь в команде.

---

## Автор

- DriftNet — P2P-файловая сеть на .NET + Docker 